# HK Insurance AML æŸ¥è©¢ç³»çµ± - ç³»çµ±æ¶æ§‹æ–‡æª”

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

æœ¬ç³»çµ±æ˜¯ä¸€å€‹åŸºæ–¼ Flask çš„ AML (åæ´—éŒ¢) æŸ¥è©¢ç³»çµ±ï¼Œçµåˆæœƒå“¡åˆ¶åº¦ç®¡ç†ï¼Œæä¾›ä¸‰å±¤æœƒå“¡æ¬Šé™çš„çŠ¯ç½ªè³‡æ–™æŸ¥è©¢æœå‹™ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- AML çŠ¯ç½ªè³‡æ–™æŸ¥è©¢ (14,528 ç­†è¨˜éŒ„)
- ä¸‰å±¤æœƒå“¡åˆ¶åº¦ (ç®¡ç†å“¡/ä»˜è²»æœƒå“¡/åŸºæœ¬æœƒå“¡)
- Email é©—è­‰è¨»å†Šæµç¨‹
- æŸ¥è©¢æ¬¡æ•¸é™åˆ¶ç®¡ç†
- ç®¡ç†å“¡å¾Œå°ç®¡ç†

---

## ğŸ—‚ï¸ æª”æ¡ˆçµæ§‹

```
/home/weschen/HK_insurance/
â”œâ”€â”€ hk-ia-function/
â”‚   â”œâ”€â”€ main_full.py                    # ä¸»è¦ Flask æ‡‰ç”¨ç¨‹å¼
â”‚   â”œâ”€â”€ setup_members.py                # æœƒå“¡è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
â”‚   â”œâ”€â”€ requirements.txt                # Python ä¾è³´å¥—ä»¶
â”‚   â”œâ”€â”€ venv/                          # Python è™›æ“¬ç’°å¢ƒ
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ base.html                  # åŸºç¤æ¨¡æ¿
â”‚       â”œâ”€â”€ login_fixed.html           # ç™»å…¥é é¢
â”‚       â”œâ”€â”€ register_fixed.html        # è¨»å†Šé é¢
â”‚       â”œâ”€â”€ admin_dashboard.html       # ç®¡ç†å“¡å„€è¡¨æ¿
â”‚       â”œâ”€â”€ member_dashboard.html      # æœƒå“¡å„€è¡¨æ¿
â”‚       â”œâ”€â”€ query_result.html          # æŸ¥è©¢çµæœé é¢
â”‚       â””â”€â”€ ...
â”œâ”€â”€ aml_profiles.db                    # AML çŠ¯ç½ªè³‡æ–™åº« (14,528 ç­†è¨˜éŒ„)
â”œâ”€â”€ members.db                         # æœƒå“¡ç³»çµ±è³‡æ–™åº«
â””â”€â”€ downloads/                         # PDF æ–‡æª”è³‡æ–™
```

---

## ğŸ”§ æŠ€è¡“æ¶æ§‹

### å¾Œç«¯æ¡†æ¶
- **Flask 3.1.2** - Web æ‡‰ç”¨æ¡†æ¶
- **SQLite** - è³‡æ–™åº«å¼•æ“
- **bcrypt** - å¯†ç¢¼åŠ å¯†
- **secrets** - å®‰å…¨éš¨æ©Ÿæ•¸ç”Ÿæˆ

### å‰ç«¯æŠ€è¡“
- **Bootstrap 5** - UI æ¡†æ¶
- **Font Awesome** - åœ–æ¨™åº«
- **jQuery** - JavaScript åº«

### é–‹ç™¼ç’°å¢ƒ
- **Python 3.x** - ç¨‹å¼èªè¨€
- **Virtual Environment** - ç’°å¢ƒéš”é›¢

---


### 2. æœƒå“¡è³‡æ–™åº« (members.db)
```sql
-- ç”¨æˆ¶è¡¨
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    role TEXT DEFAULT 'basic',
    query_limit INTEGER DEFAULT 5,
    queries_used INTEGER DEFAULT 0,
    is_verified INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);

-- æŸ¥è©¢è¨˜éŒ„è¡¨
CREATE TABLE query_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    query_term TEXT,
    result_count INTEGER,
    query_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);

-- å¯†ç¢¼é‡è¨­è¡¨
CREATE TABLE password_resets (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    token TEXT UNIQUE,
    expires_at TIMESTAMP,
    used INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);

-- Email é©—è­‰è¡¨
CREATE TABLE email_verifications (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    verification_code TEXT,
    expires_at TIMESTAMP,
    verified INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);

-- ä»˜è²»è¨˜éŒ„è¡¨
CREATE TABLE payment_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    amount DECIMAL(10,2),
    currency TEXT DEFAULT 'HKD',
    payment_method TEXT,
    transaction_id TEXT,
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);
```

---

## ğŸ” æœƒå“¡æ¬Šé™ç³»çµ±

### æœƒå“¡ç­‰ç´š
| ç­‰ç´š | æŸ¥è©¢é™åˆ¶ | åŠŸèƒ½æ¬Šé™ |
|------|----------|----------|
| **åŸºæœ¬æœƒå“¡ (basic)** | 5 æ¬¡ (ç¸½è¨ˆ) | åŸºæœ¬æŸ¥è©¢åŠŸèƒ½ |
| **ä»˜è²»æœƒå“¡ (paid)** | ç„¡é™åˆ¶ | å®Œæ•´æŸ¥è©¢åŠŸèƒ½ |
| **ç®¡ç†å“¡ (admin)** | ç„¡é™åˆ¶ | ç³»çµ±ç®¡ç†ã€ç”¨æˆ¶ç®¡ç† |

### é è¨­ç®¡ç†å“¡å¸³è™Ÿ
- **Email**: astcws@hotmail
- **å¯†ç¢¼**: admin123

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

### 1. ç”¨æˆ¶èªè­‰æ¨¡çµ„ (`main_full.py` ç¬¬ 100-200 è¡Œ)
```python
# è¨»å†ŠåŠŸèƒ½
@app.route('/register', methods=['GET', 'POST'])
def register():
    # ç”¨æˆ¶è¨»å†Šé‚è¼¯
    # å¯†ç¢¼åŠ å¯†
    # Email é©—è­‰ç¢¼ç”Ÿæˆ
    pass

# ç™»å…¥åŠŸèƒ½  
@app.route('/login', methods=['GET', 'POST'])
def login():
    # ç”¨æˆ¶ç™»å…¥é©—è­‰
    # Session ç®¡ç†
    # è§’è‰²é‡å®šå‘
    pass

# Email é©—è­‰
@app.route('/verify_email/<verification_code>')
def verify_email(verification_code):
    # Email é©—è­‰é‚è¼¯
    # å¸³è™Ÿå•Ÿç”¨
    pass
```

### 2. AML æŸ¥è©¢æ¨¡çµ„ (`main_full.py` ç¬¬ 300-400 è¡Œ)
```python
# AML è³‡æ–™æŸ¥è©¢
@app.route('/api/query', methods=['POST'])
def query_profiles():
    # æŸ¥è©¢æ¬Šé™æª¢æŸ¥
    # æŸ¥è©¢æ¬¡æ•¸æ‰£é™¤
    # è³‡æ–™åº«æŸ¥è©¢
    # çµæœè¿”å›
    pass

# æŸ¥è©¢è¨˜éŒ„
def log_query(user_id, query_term, result_count):
    # æŸ¥è©¢è¨˜éŒ„å„²å­˜
    pass
```

### 3. æœƒå“¡ç®¡ç†æ¨¡çµ„ (`main_full.py` ç¬¬ 500-600 è¡Œ)
```python
# ç®¡ç†å“¡å„€è¡¨æ¿
@app.route('/admin_dashboard')
def admin_dashboard():
    # ç”¨æˆ¶åˆ—è¡¨
    # ç³»çµ±çµ±è¨ˆ
    # ç®¡ç†åŠŸèƒ½
    pass

# ç”¨æˆ¶æ¬Šé™ä¿®æ”¹
@app.route('/admin/update_user/<int:user_id>', methods=['POST'])
def update_user(user_id):
    # æ¬Šé™ä¿®æ”¹
    # æŸ¥è©¢æ¬¡æ•¸è¨­å®š
    pass
```

### 4. Email æœå‹™æ¨¡çµ„ (å¾…å¯¦ä½œ)
```python
# SendGrid Email æœå‹™
SENDGRID_API_KEY = "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"

def send_verification_email(email, verification_code):
    # SendGrid Email ç™¼é€
    # é©—è­‰ç¢¼æ¨¡æ¿
    pass
```

---

## ğŸ¨ å‰ç«¯æ¨¡æ¿æ¶æ§‹

### åŸºç¤æ¨¡æ¿ (`templates/base.html`)
- Bootstrap 5 æ¡†æ¶
- éŸ¿æ‡‰å¼è¨­è¨ˆ
- Font Awesome åœ–æ¨™
- å°èˆªåˆ—å’Œé å°¾

### ä¸»è¦é é¢æ¨¡æ¿
1. **ç™»å…¥é é¢** (`templates/login_fixed.html`)
   - ç”¨æˆ¶ç™»å…¥è¡¨å–®
   - å¯†ç¢¼é¡¯ç¤ºåˆ‡æ›
   - Flash è¨Šæ¯é¡¯ç¤º

2. **è¨»å†Šé é¢** (`templates/register_fixed.html`)
   - ç”¨æˆ¶è¨»å†Šè¡¨å–®
   - å¯†ç¢¼å¼·åº¦æª¢æŸ¥
   - æœƒå“¡ç­‰ç´šèªªæ˜

3. **å„€è¡¨æ¿** (`templates/admin_dashboard.html`, `templates/member_dashboard.html`)
   - è§’è‰²å°ˆå±¬åŠŸèƒ½
   - æŸ¥è©¢ä»‹é¢
   - çµ±è¨ˆè³‡è¨Š

---

## ğŸ”„ ç³»çµ±æµç¨‹

### ç”¨æˆ¶è¨»å†Šæµç¨‹
1. å¡«å¯«è¨»å†Šè¡¨å–®
2. ç³»çµ±ç”Ÿæˆé©—è­‰ç¢¼
3. ç™¼é€ Email é©—è­‰
4. ç”¨æˆ¶é»æ“Šé©—è­‰é€£çµ
5. å¸³è™Ÿæ­£å¼å•Ÿç”¨

### æŸ¥è©¢æµç¨‹
1. ç”¨æˆ¶ç™»å…¥ç³»çµ±
2. æª¢æŸ¥æŸ¥è©¢æ¬Šé™
3. åŸ·è¡Œ AML è³‡æ–™æŸ¥è©¢
4. æ‰£é™¤æŸ¥è©¢æ¬¡æ•¸
5. è¿”å›æŸ¥è©¢çµæœ
6. è¨˜éŒ„æŸ¥è©¢æ—¥èªŒ

---

## ğŸ“‹ å¾…ä¿®æ”¹é …ç›®æ¸…å–®

### 1. è¨»å†Šé©—è­‰åŠŸèƒ½ âš ï¸
**æª”æ¡ˆ**: `main_full.py` (ç¬¬ 100-150 è¡Œ)
**ç¾æ³**: è¨»å†Šå¾Œç›´æ¥å•Ÿç”¨å¸³è™Ÿ
**éœ€æ±‚**: ç™¼é€ Email é©—è­‰ç¢¼ï¼Œé©—è­‰å¾Œæ‰å•Ÿç”¨
**ä¿®æ”¹é»**:
```python
# åœ¨é€™è£¡æ·»åŠ æ‚¨çš„ä¿®æ”¹èªªæ˜
```

### 2. SendGrid Email æ•´åˆ âš ï¸
**æª”æ¡ˆ**: `main_full.py` (æ–°å¢æ¨¡çµ„)
**ç¾æ³**: ç„¡ Email ç™¼é€åŠŸèƒ½
**éœ€æ±‚**: æ•´åˆ SendGrid API ç™¼é€é©—è­‰ Email
**API Key**: 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
**ä¿®æ”¹é»**:
```python
# åœ¨é€™è£¡æ·»åŠ æ‚¨çš„ä¿®æ”¹èªªæ˜
```

### 3. æ–°æœƒå“¡æŸ¥è©¢é™åˆ¶ âš ï¸
**æª”æ¡ˆ**: `main_full.py` (ç¬¬ 120 è¡Œ - è¨»å†Šå‡½æ•¸)
**ç¾æ³**: æ–°æœƒå“¡é è¨­ 10 æ¬¡æŸ¥è©¢
**éœ€æ±‚**: æ”¹ç‚º 5 æ¬¡ç¸½è¨ˆæŸ¥è©¢é™åˆ¶
**ä¿®æ”¹é»**:
```python
# åœ¨é€™è£¡æ·»åŠ æ‚¨çš„ä¿®æ”¹èªªæ˜
```

### 4. ç®¡ç†å“¡ç”¨æˆ¶ç®¡ç†åŠŸèƒ½ âš ï¸
**æª”æ¡ˆ**: `main_full.py` (ç¬¬ 500-600 è¡Œ)
**ç¾æ³**: ç®¡ç†å“¡ç„¡æ³•ä¿®æ”¹ç”¨æˆ¶æ¬Šé™
**éœ€æ±‚**: æ–°å¢ç”¨æˆ¶æ¬Šé™å’ŒæŸ¥è©¢æ¬¡æ•¸è¨­å®šåŠŸèƒ½
**ä¿®æ”¹é»**:
```python
# åœ¨é€™è£¡æ·»åŠ æ‚¨çš„ä¿®æ”¹èªªæ˜
```

### 5. æŸ¥è©¢åŠŸèƒ½ç°¡åŒ– âš ï¸
**æª”æ¡ˆ**: `main_full.py` (ç¬¬ 300-400 è¡Œ)
**ç¾æ³**: è¤‡é›œæŸ¥è©¢ä»‹é¢
**éœ€æ±‚**: ç°¡åŒ–ç‚ºåªæœå°‹å§“å
**ä¿®æ”¹é»**:
```python
# åœ¨é€™è£¡æ·»åŠ æ‚¨çš„ä¿®æ”¹èªªæ˜
```

---

## ğŸ› ï¸ é–‹ç™¼èªªæ˜

### å•Ÿå‹•ç³»çµ±
```bash
cd /home/weschen/HK_insurance/hk-ia-function
source venv/bin/activate
python main_full.py
```

### è¨ªå•åœ°å€
- **ä¸»é **: http://127.0.0.1:5000
- **ç™»å…¥**: http://127.0.0.1:5000/login
- **è¨»å†Š**: http://127.0.0.1:5000/register
- **ç®¡ç†å“¡**: http://127.0.0.1:5000/admin_dashboard

### æ¸¬è©¦å¸³è™Ÿ
- **ç®¡ç†å“¡**: astcws@hotmail / admin123

---

## ğŸ“ æ³¨æ„äº‹é …

1. **å®‰å…¨æ€§**: æ‰€æœ‰å¯†ç¢¼ä½¿ç”¨ bcrypt åŠ å¯†å„²å­˜
2. **æœƒè©±ç®¡ç†**: ä½¿ç”¨ Flask Session ç®¡ç†ç”¨æˆ¶ç‹€æ…‹
3. **è³‡æ–™åº«**: SQLite æª”æ¡ˆæ¬Šé™éœ€è¦é©ç•¶è¨­å®š
4. **Email**: SendGrid API éœ€è¦æ­£ç¢ºé…ç½®
5. **æŸ¥è©¢é™åˆ¶**: åŸºæœ¬æœƒå“¡é™åˆ¶ç‚ºæ°¸ä¹… 5 æ¬¡ï¼Œéæ¯æ—¥é‡ç½®

---

è«‹åœ¨ä¸Šè¿°ã€Œä¿®æ”¹é»ã€å€åŸŸæ·»åŠ æ‚¨çš„å…·é«”ä¿®æ”¹èªªæ˜ï¼Œæˆ‘å°‡ä¾åºé€²è¡Œç¨‹å¼ç¢¼ä¿®æ”¹ã€‚
